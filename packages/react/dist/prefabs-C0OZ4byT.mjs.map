{"version":3,"file":"prefabs-C0OZ4byT.mjs","sources":["../src/prefabs/Chat.tsx","../src/prefabs/MediaDeviceMenu.tsx","../src/hooks/useWarnAboutMissingStyles.ts","../src/prefabs/PreJoin.tsx","../src/hooks/useSettingsToggle.ts","../src/components/controls/SettingsMenuToggle.tsx","../src/prefabs/ControlBar.tsx","../src/prefabs/VideoConference.tsx","../src/prefabs/AudioConference.tsx","../src/prefabs/VoiceAssistantControlBar.tsx"],"sourcesContent":["import { type ChatMessage, type ChatOptions } from '@livekit/components-core';\r\nimport * as React from 'react';\r\nimport { useMaybeLayoutContext } from '../context';\r\nimport { cloneSingleChild } from '../utils';\r\nimport type { MessageFormatter } from '../components/ChatEntry';\r\nimport { ChatEntry } from '../components/ChatEntry';\r\nimport { useChat } from '../hooks/useChat';\r\nimport { ChatToggle } from '../components';\r\nimport ChatCloseIcon from '../assets/icons/ChatCloseIcon';\r\n\r\n/** @public */\r\nexport interface ChatProps extends React.HTMLAttributes<HTMLDivElement>, ChatOptions {\r\n  messageFormatter?: MessageFormatter;\r\n}\r\n\r\n/**\r\n * The Chat component provides ready-to-use chat functionality in a LiveKit room.\r\n * Messages are distributed to all participants in the room in real-time.\r\n *\r\n * @remarks\r\n * - Only users who are in the room at the time of dispatch will receive messages\r\n * - Message history is not persisted between sessions\r\n * - Requires `@livekit/components-styles` to be imported for styling\r\n *\r\n * @example\r\n * ```tsx\r\n * import '@livekit/components-styles';\r\n *\r\n * function Room() {\r\n *   return (\r\n *     <LiveKitRoom data-lk-theme=\"default\">\r\n *       <Chat />\r\n *     </LiveKitRoom>\r\n *   );\r\n * }\r\n * ```\r\n *\r\n * For custom styling, refer to: https://docs.livekit.io/reference/components/react/concepts/style-components/\r\n *\r\n * @public\r\n */\r\nexport function Chat({\r\n  messageFormatter,\r\n  messageDecoder,\r\n  messageEncoder,\r\n  channelTopic,\r\n  ...props\r\n}: ChatProps) {\r\n  const ulRef = React.useRef<HTMLUListElement>(null);\r\n  const inputRef = React.useRef<HTMLInputElement>(null);\r\n\r\n  const chatOptions: ChatOptions = React.useMemo(() => {\r\n    return { messageDecoder, messageEncoder, channelTopic };\r\n  }, [messageDecoder, messageEncoder, channelTopic]);\r\n\r\n  const { chatMessages, send, isSending } = useChat(chatOptions);\r\n\r\n  const layoutContext = useMaybeLayoutContext();\r\n  const lastReadMsgAt = React.useRef<ChatMessage['timestamp']>(0);\r\n\r\n  async function handleSubmit(event: React.FormEvent) {\r\n    event.preventDefault();\r\n    if (inputRef.current && inputRef.current.value.trim() !== '') {\r\n      await send(inputRef.current.value);\r\n      inputRef.current.value = '';\r\n      inputRef.current.focus();\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    if (ulRef) {\r\n      ulRef.current?.scrollTo({ top: ulRef.current.scrollHeight });\r\n    }\r\n  }, [ulRef, chatMessages]);\r\n\r\n  React.useEffect(() => {\r\n    if (!layoutContext || chatMessages.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      layoutContext.widget.state?.showChat &&\r\n      chatMessages.length > 0 &&\r\n      lastReadMsgAt.current !== chatMessages[chatMessages.length - 1]?.timestamp\r\n    ) {\r\n      lastReadMsgAt.current = chatMessages[chatMessages.length - 1]?.timestamp;\r\n      return;\r\n    }\r\n\r\n    const unreadMessageCount = chatMessages.filter(\r\n      (msg) => !lastReadMsgAt.current || msg.timestamp > lastReadMsgAt.current,\r\n    ).length;\r\n\r\n    const { widget } = layoutContext;\r\n    if (unreadMessageCount > 0 && widget.state?.unreadMessages !== unreadMessageCount) {\r\n      widget.dispatch?.({ msg: 'unread_msg', count: unreadMessageCount });\r\n    }\r\n  }, [chatMessages, layoutContext?.widget]);\r\n\r\n  return (\r\n    <div {...props} className=\"lk-chat\">\r\n      <div className=\"lk-chat-header\">\r\n        Сообщения\r\n        {layoutContext && (\r\n          <ChatToggle className=\"lk-close-button\">\r\n            <ChatCloseIcon />\r\n          </ChatToggle>\r\n        )}\r\n      </div>\r\n\r\n      <ul className=\"lk-list lk-chat-messages\" ref={ulRef}>\r\n        {props.children\r\n          ? chatMessages.map((msg, idx) =>\r\n              cloneSingleChild(props.children, {\r\n                entry: msg,\r\n                key: msg.id ?? idx,\r\n                messageFormatter,\r\n              }),\r\n            )\r\n          : chatMessages.map((msg, idx, allMsg) => {\r\n              const hideName = idx >= 1 && allMsg[idx - 1].from === msg.from;\r\n              // If the time delta between two messages is bigger than 60s show timestamp.\r\n              const hideTimestamp = idx >= 1 && msg.timestamp - allMsg[idx - 1].timestamp < 60_000;\r\n\r\n              return (\r\n                <ChatEntry\r\n                  key={msg.id ?? idx}\r\n                  hideName={hideName}\r\n                  hideTimestamp={hideName === false ? false : hideTimestamp} // If we show the name always show the timestamp as well.\r\n                  entry={msg}\r\n                  messageFormatter={messageFormatter}\r\n                />\r\n              );\r\n            })}\r\n      </ul>\r\n      <form className=\"lk-chat-form\" onSubmit={handleSubmit}>\r\n        <input\r\n          className=\"lk-form-control lk-chat-form-input\"\r\n          disabled={isSending}\r\n          ref={inputRef}\r\n          type=\"text\"\r\n          placeholder=\"Введите сообщение\"\r\n          onInput={(ev) => ev.stopPropagation()}\r\n          onKeyDown={(ev) => ev.stopPropagation()}\r\n          onKeyUp={(ev) => ev.stopPropagation()}\r\n        />\r\n        <button type=\"submit\" className=\"lk-button lk-chat-form-button\" disabled={isSending}>\r\n          Отправить\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","import { computeMenuPosition, wasClickOutside, log } from '@livekit/components-core';\r\nimport * as React from 'react';\r\nimport { MediaDeviceSelect } from '../components/controls/MediaDeviceSelect';\r\nimport type { LocalAudioTrack, LocalVideoTrack } from 'livekit-client';\r\n\r\n/** @public */\r\nexport interface MediaDeviceMenuProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n  kind?: MediaDeviceKind;\r\n  initialSelection?: string;\r\n  onActiveDeviceChange?: (kind: MediaDeviceKind, deviceId: string) => void;\r\n  tracks?: Partial<Record<MediaDeviceKind, LocalAudioTrack | LocalVideoTrack | undefined>>;\r\n  /**\r\n   * this will call getUserMedia if the permissions are not yet given to enumerate the devices with device labels.\r\n   * in some browsers multiple calls to getUserMedia result in multiple permission prompts.\r\n   * It's generally advised only flip this to true, once a (preview) track has been acquired successfully with the\r\n   * appropriate permissions.\r\n   *\r\n   * @see {@link PreJoin}\r\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices | MDN enumerateDevices}\r\n   */\r\n  requestPermissions?: boolean;\r\n}\r\n\r\n/**\r\n * The `MediaDeviceMenu` component is a button that opens a menu that lists\r\n * all media devices and allows the user to select them.\r\n *\r\n * @remarks\r\n * This component is implemented with the `MediaDeviceSelect` LiveKit components.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <MediaDeviceMenu />\r\n * </LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function MediaDeviceMenu({\r\n  kind,\r\n  initialSelection,\r\n  onActiveDeviceChange,\r\n  tracks,\r\n  requestPermissions = false,\r\n  ...props\r\n}: MediaDeviceMenuProps) {\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  const [devices, setDevices] = React.useState<MediaDeviceInfo[]>([]);\r\n  const [updateRequired, setUpdateRequired] = React.useState<boolean>(true);\r\n  const [needPermissions, setNeedPermissions] = React.useState(requestPermissions);\r\n\r\n  const handleActiveDeviceChange = (kind: MediaDeviceKind, deviceId: string) => {\r\n    log.debug('handle device change');\r\n    setIsOpen(false);\r\n    onActiveDeviceChange?.(kind, deviceId);\r\n  };\r\n\r\n  const button = React.useRef<HTMLButtonElement>(null);\r\n  const tooltip = React.useRef<HTMLDivElement>(null);\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (isOpen) {\r\n      setNeedPermissions(true);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  React.useLayoutEffect(() => {\r\n    let cleanup: ReturnType<typeof computeMenuPosition> | undefined;\r\n    if (button.current && tooltip.current && (devices || updateRequired)) {\r\n      cleanup = computeMenuPosition(button.current, tooltip.current, (x, y) => {\r\n        if (tooltip.current) {\r\n          Object.assign(tooltip.current.style, { left: `${x}px`, top: `${y}px` });\r\n        }\r\n      });\r\n    }\r\n    setUpdateRequired(false);\r\n    return () => {\r\n      cleanup?.();\r\n    };\r\n  }, [button, tooltip, devices, updateRequired]);\r\n\r\n  const handleClickOutside = React.useCallback(\r\n    (event: MouseEvent) => {\r\n      if (!tooltip.current) {\r\n        return;\r\n      }\r\n      if (event.target === button.current) {\r\n        return;\r\n      }\r\n      if (isOpen && wasClickOutside(tooltip.current, event)) {\r\n        setIsOpen(false);\r\n      }\r\n    },\r\n    [isOpen, tooltip, button],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    document.addEventListener<'click'>('click', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener<'click'>('click', handleClickOutside);\r\n    };\r\n  }, [handleClickOutside]);\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        className=\"lk-button lk-button-menu\"\r\n        aria-pressed={isOpen}\r\n        {...props}\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        ref={button}\r\n      >\r\n        {props.children}\r\n      </button>\r\n      {/** only render when enabled in order to make sure that the permissions are requested only if the menu is enabled */}\r\n      {!props.disabled && (\r\n        <div\r\n          className=\"lk-device-menu\"\r\n          ref={tooltip}\r\n          style={{ visibility: isOpen ? 'visible' : 'hidden' }}\r\n        >\r\n          {kind ? (\r\n            <MediaDeviceSelect\r\n              initialSelection={initialSelection}\r\n              onActiveDeviceChange={(deviceId) => handleActiveDeviceChange(kind, deviceId)}\r\n              onDeviceListChange={setDevices}\r\n              kind={kind}\r\n              track={tracks?.[kind]}\r\n              requestPermissions={needPermissions}\r\n            />\r\n          ) : (\r\n            <>\r\n            <div className=\"lk-device-menu-heading\">Аудио-устройства</div>\r\n              <MediaDeviceSelect\r\n                kind=\"audioinput\"\r\n                onActiveDeviceChange={(deviceId) =>\r\n                  handleActiveDeviceChange('audioinput', deviceId)\r\n                }\r\n                onDeviceListChange={setDevices}\r\n                track={tracks?.audioinput}\r\n                requestPermissions={needPermissions}\r\n              />\r\n            <div className=\"lk-device-menu-heading\">Видео-устройства</div>\r\n              <MediaDeviceSelect\r\n                kind=\"videoinput\"\r\n                onActiveDeviceChange={(deviceId) =>\r\n                  handleActiveDeviceChange('videoinput', deviceId)\r\n                }\r\n                onDeviceListChange={setDevices}\r\n                track={tracks?.videoinput}\r\n                requestPermissions={needPermissions}\r\n              />\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport { warnAboutMissingStyles } from '../utils';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function useWarnAboutMissingStyles() {\r\n  React.useEffect(() => {\r\n    warnAboutMissingStyles();\r\n  }, []);\r\n}\r\n","import type {\r\n  CreateLocalTracksOptions,\r\n  LocalAudioTrack,\r\n  LocalVideoTrack,\r\n  TrackProcessor,\r\n} from 'livekit-client';\r\nimport {\r\n  createLocalAudioTrack,\r\n  createLocalTracks,\r\n  createLocalVideoTrack,\r\n  facingModeFromLocalTrack,\r\n  Track,\r\n  VideoPresets,\r\n  Mutex,\r\n} from 'livekit-client';\r\nimport * as React from 'react';\r\nimport { MediaDeviceMenu } from './MediaDeviceMenu';\r\nimport { TrackToggle } from '../components/controls/TrackToggle';\r\nimport type { LocalUserChoices } from '@livekit/components-core';\r\nimport { log } from '@livekit/components-core';\r\nimport { ParticipantPlaceholder } from '../assets/images';\r\nimport { useMediaDevices, usePersistentUserChoices } from '../hooks';\r\nimport { useWarnAboutMissingStyles } from '../hooks/useWarnAboutMissingStyles';\r\nimport { roomOptionsStringifyReplacer } from '../utils';\r\n\r\n/**\r\n * Props for the PreJoin component.\r\n * @public\r\n */\r\nexport interface PreJoinProps\r\n  extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onSubmit' | 'onError'> {\r\n  /** This function is called with the `LocalUserChoices` if validation is passed. */\r\n  onSubmit?: (values: LocalUserChoices) => void;\r\n  /**\r\n   * Provide your custom validation function. Only if validation is successful the user choices are past to the onSubmit callback.\r\n   */\r\n  onValidate?: (values: LocalUserChoices) => boolean;\r\n  onError?: (error: Error) => void;\r\n  /** Prefill the input form with initial values. */\r\n  defaults?: Partial<LocalUserChoices>;\r\n  /** Display a debug window for your convenience. */\r\n  debug?: boolean;\r\n  joinLabel?: string;\r\n  micLabel?: string;\r\n  camLabel?: string;\r\n  userLabel?: string;\r\n  /**\r\n   * If true, user choices are persisted across sessions.\r\n   * @defaultValue true\r\n   * @alpha\r\n   */\r\n  persistUserChoices?: boolean;\r\n  videoProcessor?: TrackProcessor<Track.Kind.Video>;\r\n}\r\n\r\n/** @public */\r\nexport function usePreviewTracks(\r\n  options: CreateLocalTracksOptions,\r\n  onError?: (err: Error) => void,\r\n) {\r\n  const [tracks, setTracks] = React.useState<Array<LocalAudioTrack | LocalVideoTrack>>();\r\n\r\n  const trackLock = React.useMemo(() => new Mutex(), []);\r\n\r\n  React.useEffect(() => {\r\n    let needsCleanup = false;\r\n    let localTracks: Array<LocalAudioTrack | LocalVideoTrack> = [];\r\n    trackLock.lock().then(async (unlock) => {\r\n      try {\r\n        if (options.audio || options.video) {\r\n          localTracks = (await createLocalTracks(options)) as Array<\r\n            LocalAudioTrack | LocalVideoTrack\r\n          >;\r\n\r\n          if (needsCleanup) {\r\n            localTracks.forEach((tr) => tr.stop());\r\n          } else {\r\n            setTracks(localTracks);\r\n          }\r\n        }\r\n      } catch (e: unknown) {\r\n        if (onError && e instanceof Error) {\r\n          onError(e);\r\n        } else {\r\n          log.error(e);\r\n        }\r\n      } finally {\r\n        unlock();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      needsCleanup = true;\r\n      localTracks.forEach((track) => {\r\n        track.stop();\r\n      });\r\n    };\r\n  }, [JSON.stringify(options, roomOptionsStringifyReplacer), onError, trackLock]);\r\n\r\n  return tracks;\r\n}\r\n\r\n/**\r\n * @public\r\n * @deprecated use `usePreviewTracks` instead\r\n */\r\nexport function usePreviewDevice<T extends LocalVideoTrack | LocalAudioTrack>(\r\n  enabled: boolean,\r\n  deviceId: string,\r\n  kind: 'videoinput' | 'audioinput',\r\n) {\r\n  const [deviceError, setDeviceError] = React.useState<Error | null>(null);\r\n  const [isCreatingTrack, setIsCreatingTrack] = React.useState<boolean>(false);\r\n\r\n  const devices = useMediaDevices({ kind });\r\n  const [selectedDevice, setSelectedDevice] = React.useState<MediaDeviceInfo | undefined>(\r\n    undefined,\r\n  );\r\n\r\n  const [localTrack, setLocalTrack] = React.useState<T>();\r\n  const [localDeviceId, setLocalDeviceId] = React.useState<string>(deviceId);\r\n\r\n  React.useEffect(() => {\r\n    setLocalDeviceId(deviceId);\r\n  }, [deviceId]);\r\n\r\n  const createTrack = async (deviceId: string, kind: 'videoinput' | 'audioinput') => {\r\n    try {\r\n      const track =\r\n        kind === 'videoinput'\r\n          ? await createLocalVideoTrack({\r\n              deviceId,\r\n              resolution: VideoPresets.h720.resolution,\r\n            })\r\n          : await createLocalAudioTrack({ deviceId });\r\n\r\n      const newDeviceId = await track.getDeviceId(false);\r\n      if (newDeviceId && deviceId !== newDeviceId) {\r\n        prevDeviceId.current = newDeviceId;\r\n        setLocalDeviceId(newDeviceId);\r\n      }\r\n      setLocalTrack(track as T);\r\n    } catch (e) {\r\n      if (e instanceof Error) {\r\n        setDeviceError(e);\r\n      }\r\n    }\r\n  };\r\n\r\n  const switchDevice = async (track: LocalVideoTrack | LocalAudioTrack, id: string) => {\r\n    await track.setDeviceId(id);\r\n    prevDeviceId.current = id;\r\n  };\r\n\r\n  const prevDeviceId = React.useRef(localDeviceId);\r\n\r\n  React.useEffect(() => {\r\n    if (enabled && !localTrack && !deviceError && !isCreatingTrack) {\r\n      log.debug('creating track', kind);\r\n      setIsCreatingTrack(true);\r\n      createTrack(localDeviceId, kind).finally(() => {\r\n        setIsCreatingTrack(false);\r\n      });\r\n    }\r\n  }, [enabled, localTrack, deviceError, isCreatingTrack]);\r\n\r\n  // switch camera device\r\n  React.useEffect(() => {\r\n    if (!localTrack) {\r\n      return;\r\n    }\r\n    if (!enabled) {\r\n      log.debug(`muting ${kind} track`);\r\n      localTrack.mute().then(() => log.debug(localTrack.mediaStreamTrack));\r\n    } else if (selectedDevice?.deviceId && prevDeviceId.current !== selectedDevice?.deviceId) {\r\n      log.debug(`switching ${kind} device from`, prevDeviceId.current, selectedDevice.deviceId);\r\n      switchDevice(localTrack, selectedDevice.deviceId);\r\n    } else {\r\n      log.debug(`unmuting local ${kind} track`);\r\n      localTrack.unmute();\r\n    }\r\n  }, [localTrack, selectedDevice, enabled, kind]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (localTrack) {\r\n        log.debug(`stopping local ${kind} track`);\r\n        localTrack.stop();\r\n        localTrack.mute();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    setSelectedDevice(devices?.find((dev) => dev.deviceId === localDeviceId));\r\n  }, [localDeviceId, devices]);\r\n\r\n  return {\r\n    selectedDevice,\r\n    localTrack,\r\n    deviceError,\r\n  };\r\n}\r\n\r\n/**\r\n * The `PreJoin` prefab component is normally presented to the user before he enters a room.\r\n * This component allows the user to check and select the preferred media device (camera und microphone).\r\n * On submit the user decisions are returned, which can then be passed on to the `LiveKitRoom` so that the user enters the room with the correct media devices.\r\n *\r\n * @remarks\r\n * This component is independent of the `LiveKitRoom` component and should not be nested within it.\r\n * Because it only accesses the local media tracks this component is self-contained and works without connection to the LiveKit server.\r\n *\r\n * @example\r\n * ```tsx\r\n * <PreJoin />\r\n * ```\r\n * @public\r\n */\r\nexport function PreJoin({\r\n  defaults = {},\r\n  onValidate,\r\n  onSubmit,\r\n  onError,\r\n  debug,\r\n  joinLabel = 'Войти в комнату',\r\n  micLabel = 'Микрофон',\r\n  camLabel = 'Камера',\r\n  userLabel = 'Имя пользователя',\r\n  persistUserChoices = true,\r\n  videoProcessor,\r\n  ...htmlProps\r\n}: PreJoinProps) {\r\n  const {\r\n    userChoices: initialUserChoices,\r\n    saveAudioInputDeviceId,\r\n    saveAudioInputEnabled,\r\n    saveVideoInputDeviceId,\r\n    saveVideoInputEnabled,\r\n    saveUsername,\r\n  } = usePersistentUserChoices({\r\n    defaults,\r\n    preventSave: !persistUserChoices,\r\n    preventLoad: !persistUserChoices,\r\n  });\r\n\r\n  const [userChoices, setUserChoices] = React.useState(initialUserChoices);\r\n\r\n  // Initialize device settings\r\n  const [audioEnabled, setAudioEnabled] = React.useState<boolean>(userChoices.audioEnabled);\r\n  const [videoEnabled, setVideoEnabled] = React.useState<boolean>(userChoices.videoEnabled);\r\n  const [audioDeviceId, setAudioDeviceId] = React.useState<string>(userChoices.audioDeviceId);\r\n  const [videoDeviceId, setVideoDeviceId] = React.useState<string>(userChoices.videoDeviceId);\r\n  const [username, setUsername] = React.useState(userChoices.username);\r\n\r\n  // Save user choices to persistent storage.\r\n  React.useEffect(() => {\r\n    saveAudioInputEnabled(audioEnabled);\r\n  }, [audioEnabled, saveAudioInputEnabled]);\r\n  React.useEffect(() => {\r\n    saveVideoInputEnabled(videoEnabled);\r\n  }, [videoEnabled, saveVideoInputEnabled]);\r\n  React.useEffect(() => {\r\n    saveAudioInputDeviceId(audioDeviceId);\r\n  }, [audioDeviceId, saveAudioInputDeviceId]);\r\n  React.useEffect(() => {\r\n    saveVideoInputDeviceId(videoDeviceId);\r\n  }, [videoDeviceId, saveVideoInputDeviceId]);\r\n  React.useEffect(() => {\r\n    saveUsername(username);\r\n  }, [username, saveUsername]);\r\n\r\n  const tracks = usePreviewTracks(\r\n    {\r\n      audio: audioEnabled ? { deviceId: initialUserChoices.audioDeviceId } : false,\r\n      video: videoEnabled\r\n        ? { deviceId: initialUserChoices.videoDeviceId, processor: videoProcessor }\r\n        : false,\r\n    },\r\n    onError,\r\n  );\r\n\r\n  const videoEl = React.useRef(null);\r\n\r\n  const videoTrack = React.useMemo(\r\n    () => tracks?.filter((track) => track.kind === Track.Kind.Video)[0] as LocalVideoTrack,\r\n    [tracks],\r\n  );\r\n\r\n  const facingMode = React.useMemo(() => {\r\n    if (videoTrack) {\r\n      const { facingMode } = facingModeFromLocalTrack(videoTrack);\r\n      return facingMode;\r\n    } else {\r\n      return 'undefined';\r\n    }\r\n  }, [videoTrack]);\r\n\r\n  const audioTrack = React.useMemo(\r\n    () => tracks?.filter((track) => track.kind === Track.Kind.Audio)[0] as LocalAudioTrack,\r\n    [tracks],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (videoEl.current && videoTrack) {\r\n      videoTrack.unmute();\r\n      videoTrack.attach(videoEl.current);\r\n    }\r\n\r\n    return () => {\r\n      videoTrack?.detach();\r\n    };\r\n  }, [videoTrack]);\r\n\r\n  const [isValid, setIsValid] = React.useState<boolean>();\r\n\r\n  const handleValidation = React.useCallback(\r\n    (values: LocalUserChoices) => {\r\n      if (typeof onValidate === 'function') {\r\n        return onValidate(values);\r\n      } else {\r\n        return values.username !== '';\r\n      }\r\n    },\r\n    [onValidate],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    const newUserChoices = {\r\n      username,\r\n      videoEnabled,\r\n      videoDeviceId,\r\n      audioEnabled,\r\n      audioDeviceId,\r\n    };\r\n    setUserChoices(newUserChoices);\r\n    setIsValid(handleValidation(newUserChoices));\r\n  }, [username, videoEnabled, handleValidation, audioEnabled, audioDeviceId, videoDeviceId]);\r\n\r\n  function handleSubmit(event: React.FormEvent) {\r\n    event.preventDefault();\r\n    if (handleValidation(userChoices)) {\r\n      if (typeof onSubmit === 'function') {\r\n        onSubmit(userChoices);\r\n      }\r\n    } else {\r\n      log.warn('Validation failed with: ', userChoices);\r\n    }\r\n  }\r\n\r\n  useWarnAboutMissingStyles();\r\n\r\n  return (\r\n    <div className=\"lk-prejoin\" {...htmlProps}>\r\n      <div className=\"lk-video-container\">\r\n        {videoTrack && (\r\n          <video ref={videoEl} width=\"1280\" height=\"720\" data-lk-facing-mode={facingMode} />\r\n        )}\r\n        {(!videoTrack || !videoEnabled) && (\r\n          <div className=\"lk-camera-off-note\">\r\n            <ParticipantPlaceholder />\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"lk-button-group-container\">\r\n        <div className=\"lk-button-group audio\">\r\n          <TrackToggle\r\n            initialState={audioEnabled}\r\n            source={Track.Source.Microphone}\r\n            onChange={(enabled) => setAudioEnabled(enabled)}\r\n          >\r\n            {micLabel}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              initialSelection={audioDeviceId}\r\n              kind=\"audioinput\"\r\n              disabled={!audioTrack}\r\n              tracks={{ audioinput: audioTrack }}\r\n              onActiveDeviceChange={(_, id) => setAudioDeviceId(id)}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"lk-button-group video\">\r\n          <TrackToggle\r\n            initialState={videoEnabled}\r\n            source={Track.Source.Camera}\r\n            onChange={(enabled) => setVideoEnabled(enabled)}\r\n          >\r\n            {camLabel}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              initialSelection={videoDeviceId}\r\n              kind=\"videoinput\"\r\n              disabled={!videoTrack}\r\n              tracks={{ videoinput: videoTrack }}\r\n              onActiveDeviceChange={(_, id) => setVideoDeviceId(id)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <form className=\"lk-username-container\">\r\n        <input\r\n          className=\"lk-form-control\"\r\n          id=\"username\"\r\n          name=\"username\"\r\n          type=\"text\"\r\n          defaultValue={username}\r\n          placeholder={userLabel}\r\n          onChange={(inputEl) => setUsername(inputEl.target.value)}\r\n          autoComplete=\"off\"\r\n        />\r\n        <button\r\n          className=\"lk-button lk-join-button\"\r\n          type=\"submit\"\r\n          onClick={handleSubmit}\r\n          disabled={!isValid}\r\n        >\r\n          {joinLabel}\r\n        </button>\r\n      </form>\r\n\r\n      {debug && (\r\n        <>\r\n          <strong>Выбор пользователя:</strong>\r\n          <ul className=\"lk-list\" style={{ overflow: 'hidden', maxWidth: '15rem' }}>\r\n            <li>Имя пользователя: {`${userChoices.username}`}</li>\r\n            <li>Видео включено: {`${userChoices.videoEnabled}`}</li>\r\n            <li>Аудио включено: {`${userChoices.audioEnabled}`}</li>\r\n            <li>Видео-устройство: {`${userChoices.videoDeviceId}`}</li>\r\n            <li>Аудио-устройство: {`${userChoices.audioDeviceId}`}</li>\r\n          </ul>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useLayoutContext } from '../context';\r\nimport { mergeProps } from '../mergeProps';\r\nimport * as React from 'react';\r\n\r\n/** @alpha */\r\nexport interface UseSettingsToggleProps {\r\n  props: React.ButtonHTMLAttributes<HTMLButtonElement>;\r\n}\r\n\r\n/**\r\n * The `useSettingsToggle` hook provides state and functions for toggling the settings menu.\r\n * @remarks\r\n * Depends on the `LayoutContext` to work properly.\r\n * @see {@link SettingsMenu}\r\n * @alpha\r\n */\r\nexport function useSettingsToggle({ props }: UseSettingsToggleProps) {\r\n  const { dispatch, state } = useLayoutContext().widget;\r\n  const className = 'lk-button lk-settings-toggle';\r\n\r\n  const mergedProps = React.useMemo(() => {\r\n    return mergeProps(props, {\r\n      className,\r\n      onClick: () => {\r\n        if (dispatch) dispatch({ msg: 'toggle_settings' });\r\n      },\r\n      'aria-pressed': state?.showSettings ? 'true' : 'false',\r\n    });\r\n  }, [props, className, dispatch, state]);\r\n\r\n  return { mergedProps };\r\n}\r\n","import * as React from 'react';\r\nimport { useSettingsToggle } from '../../hooks/useSettingsToggle';\r\n\r\n/** @alpha */\r\nexport interface SettingsMenuToggleProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {}\r\n\r\n/**\r\n * The `SettingsMenuToggle` component is a button that toggles the visibility of the `SettingsMenu` component.\r\n * @remarks\r\n * For the component to have any effect it has to live inside a `LayoutContext` context.\r\n *\r\n * @alpha\r\n */\r\nexport const SettingsMenuToggle: (\r\n  props: SettingsMenuToggleProps & React.RefAttributes<HTMLButtonElement>,\r\n) => React.ReactNode = /* @__PURE__ */ React.forwardRef<HTMLButtonElement, SettingsMenuToggleProps>(\r\n  function SettingsMenuToggle(props: SettingsMenuToggleProps, ref) {\r\n    const { mergedProps } = useSettingsToggle({ props });\r\n\r\n    return (\r\n      <button ref={ref} {...mergedProps}>\r\n        {props.children}\r\n      </button>\r\n    );\r\n  },\r\n);\r\n","import { Track } from 'livekit-client';\r\nimport * as React from 'react';\r\nimport { MediaDeviceMenu } from './MediaDeviceMenu';\r\nimport { DisconnectButton } from '../components/controls/DisconnectButton';\r\nimport { TrackToggle } from '../components/controls/TrackToggle';\r\nimport { ChatIcon, GearIcon, LeaveIcon } from '../assets/icons';\r\nimport { ChatToggle } from '../components/controls/ChatToggle';\r\nimport { useLocalParticipantPermissions, usePersistentUserChoices } from '../hooks';\r\nimport { useMediaQuery } from '../hooks/internal';\r\nimport { useMaybeLayoutContext } from '../context';\r\nimport { supportsScreenSharing } from '@livekit/components-core';\r\nimport { mergeProps } from '../utils';\r\nimport { StartMediaButton } from '../components/controls/StartMediaButton';\r\nimport { SettingsMenuToggle } from '../components/controls/SettingsMenuToggle';\r\n\r\n/** @public */\r\nexport type ControlBarControls = {\r\n  microphone?: boolean;\r\n  camera?: boolean;\r\n  chat?: boolean;\r\n  screenShare?: boolean;\r\n  leave?: boolean;\r\n  settings?: boolean;\r\n};\r\n\r\nconst trackSourceToProtocol = (source: Track.Source) => {\r\n  // NOTE: this mapping avoids importing the protocol package as that leads to a significant bundle size increase\r\n  switch (source) {\r\n    case Track.Source.Camera:\r\n      return 1;\r\n    case Track.Source.Microphone:\r\n      return 2;\r\n    case Track.Source.ScreenShare:\r\n      return 3;\r\n    default:\r\n      return 0;\r\n  }\r\n};\r\n\r\n/** @public */\r\nexport interface ControlBarProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  onDeviceError?: (error: { source: Track.Source; error: Error }) => void;\r\n  variation?: 'minimal' | 'verbose' | 'textOnly';\r\n  controls?: ControlBarControls;\r\n  /**\r\n   * If `true`, the user's device choices will be persisted.\r\n   * This will enable the user to have the same device choices when they rejoin the room.\r\n   * @defaultValue true\r\n   * @alpha\r\n   */\r\n  saveUserChoices?: boolean;\r\n}\r\n\r\n/**\r\n * The `ControlBar` prefab gives the user the basic user interface to control their\r\n * media devices (camera, microphone and screen share), open the `Chat` and leave the room.\r\n *\r\n * @remarks\r\n * This component is build with other LiveKit components like `TrackToggle`,\r\n * `DeviceSelectorButton`, `DisconnectButton` and `StartAudio`.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <ControlBar />\r\n * </LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function ControlBar({\r\n  variation,\r\n  controls,\r\n  saveUserChoices = true,\r\n  onDeviceError,\r\n  ...props\r\n}: ControlBarProps) {\r\n  const [isChatOpen, setIsChatOpen] = React.useState(false);\r\n  const layoutContext = useMaybeLayoutContext();\r\n  React.useEffect(() => {\r\n    if (layoutContext?.widget.state?.showChat !== undefined) {\r\n      setIsChatOpen(layoutContext?.widget.state?.showChat);\r\n    }\r\n  }, [layoutContext?.widget.state?.showChat]);\r\n  const isTooLittleSpace = useMediaQuery(`(max-width: ${isChatOpen ? 1000 : 760}px)`);\r\n\r\n  const defaultVariation = isTooLittleSpace ? 'minimal' : 'verbose';\r\n  variation ??= defaultVariation;\r\n\r\n  const visibleControls = { leave: true, ...controls };\r\n\r\n  const localPermissions = useLocalParticipantPermissions();\r\n\r\n  if (!localPermissions) {\r\n    visibleControls.camera = false;\r\n    visibleControls.chat = false;\r\n    visibleControls.microphone = false;\r\n    visibleControls.screenShare = false;\r\n  } else {\r\n    const canPublishSource = (source: Track.Source) => {\r\n      return (\r\n        localPermissions.canPublish &&\r\n        (localPermissions.canPublishSources.length === 0 ||\r\n          localPermissions.canPublishSources.includes(trackSourceToProtocol(source)))\r\n      );\r\n    };\r\n    visibleControls.camera ??= canPublishSource(Track.Source.Camera);\r\n    visibleControls.microphone ??= canPublishSource(Track.Source.Microphone);\r\n    visibleControls.screenShare ??= canPublishSource(Track.Source.ScreenShare);\r\n    visibleControls.chat ??= localPermissions.canPublishData && controls?.chat;\r\n  }\r\n\r\n  const showIcon = React.useMemo(\r\n    () => variation === 'minimal' || variation === 'verbose',\r\n    [variation],\r\n  );\r\n  const showText = React.useMemo(\r\n    () => variation === 'textOnly' || variation === 'verbose',\r\n    [variation],\r\n  );\r\n\r\n  const browserSupportsScreenSharing = supportsScreenSharing();\r\n\r\n  const [isScreenShareEnabled, setIsScreenShareEnabled] = React.useState(false);\r\n\r\n  const onScreenShareChange = React.useCallback(\r\n    (enabled: boolean) => {\r\n      setIsScreenShareEnabled(enabled);\r\n    },\r\n    [setIsScreenShareEnabled],\r\n  );\r\n\r\n  const htmlProps = mergeProps({ className: 'lk-control-bar' }, props);\r\n\r\n  const {\r\n    saveAudioInputEnabled,\r\n    saveVideoInputEnabled,\r\n    saveAudioInputDeviceId,\r\n    saveVideoInputDeviceId,\r\n  } = usePersistentUserChoices({ preventSave: !saveUserChoices });\r\n\r\n  const microphoneOnChange = React.useCallback(\r\n    (enabled: boolean, isUserInitiated: boolean) =>\r\n      isUserInitiated ? saveAudioInputEnabled(enabled) : null,\r\n    [saveAudioInputEnabled],\r\n  );\r\n\r\n  const cameraOnChange = React.useCallback(\r\n    (enabled: boolean, isUserInitiated: boolean) =>\r\n      isUserInitiated ? saveVideoInputEnabled(enabled) : null,\r\n    [saveVideoInputEnabled],\r\n  );\r\n\r\n  return (\r\n    <div {...htmlProps}>\r\n      {visibleControls.microphone && (\r\n        <div className=\"lk-button-group\">\r\n          <TrackToggle\r\n            source={Track.Source.Microphone}\r\n            showIcon={showIcon}\r\n            onChange={microphoneOnChange}\r\n            onDeviceError={(error) => onDeviceError?.({ source: Track.Source.Microphone, error })}\r\n          >\r\n            {showText && 'Микрофон'}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              kind=\"audioinput\"\r\n              onActiveDeviceChange={(_kind, deviceId) =>\r\n                saveAudioInputDeviceId(deviceId ?? 'default')\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {visibleControls.camera && (\r\n        <div className=\"lk-button-group\">\r\n          <TrackToggle\r\n            source={Track.Source.Camera}\r\n            showIcon={showIcon}\r\n            onChange={cameraOnChange}\r\n            onDeviceError={(error) => onDeviceError?.({ source: Track.Source.Camera, error })}\r\n          >\r\n            {showText && 'Камера'}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              kind=\"videoinput\"\r\n              onActiveDeviceChange={(_kind, deviceId) =>\r\n                saveVideoInputDeviceId(deviceId ?? 'default')\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {visibleControls.screenShare && browserSupportsScreenSharing && (\r\n        <TrackToggle\r\n          source={Track.Source.ScreenShare}\r\n          captureOptions={{ audio: true, selfBrowserSurface: 'include' }}\r\n          showIcon={showIcon}\r\n          onChange={onScreenShareChange}\r\n          onDeviceError={(error) => onDeviceError?.({ source: Track.Source.ScreenShare, error })}\r\n        >\r\n          {showText && (isScreenShareEnabled ? 'Остановить показ экрана' : 'Поделиться экраном')}\r\n        </TrackToggle>\r\n      )}\r\n      {visibleControls.chat && (\r\n        <ChatToggle>\r\n          {showIcon && <ChatIcon />}\r\n          {showText && 'Чат'}\r\n        </ChatToggle>\r\n      )}\r\n      {visibleControls.settings && (\r\n        <SettingsMenuToggle>\r\n          {showIcon && <GearIcon />}\r\n          {showText && 'Настройки'}\r\n        </SettingsMenuToggle>\r\n      )}\r\n      {visibleControls.leave && (\r\n        <DisconnectButton>\r\n          {showIcon && <LeaveIcon />}\r\n          {showText && 'Выйти'}\r\n        </DisconnectButton>\r\n      )}\r\n      <StartMediaButton />\r\n    </div>\r\n  );\r\n}\r\n","import type {\r\n  MessageDecoder,\r\n  MessageEncoder,\r\n  TrackReferenceOrPlaceholder,\r\n  WidgetState,\r\n} from '@livekit/components-core';\r\nimport { isEqualTrackRef, isTrackReference, isWeb, log } from '@livekit/components-core';\r\nimport { RoomEvent, Track } from 'livekit-client';\r\nimport * as React from 'react';\r\nimport type { MessageFormatter } from '../components';\r\nimport {\r\n  CarouselLayout,\r\n  ConnectionStateToast,\r\n  FocusLayout,\r\n  FocusLayoutContainer,\r\n  GridLayout,\r\n  LayoutContextProvider,\r\n  ParticipantTile,\r\n  RoomAudioRenderer,\r\n} from '../components';\r\nimport { useCreateLayoutContext } from '../context';\r\nimport { usePinnedTracks, useTracks } from '../hooks';\r\nimport { Chat } from './Chat';\r\nimport { ControlBar } from './ControlBar';\r\nimport { useWarnAboutMissingStyles } from '../hooks/useWarnAboutMissingStyles';\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface VideoConferenceProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  chatMessageFormatter?: MessageFormatter;\r\n  chatMessageEncoder?: MessageEncoder;\r\n  chatMessageDecoder?: MessageDecoder;\r\n  /** @alpha */\r\n  SettingsComponent?: React.ComponentType;\r\n}\r\n\r\n/**\r\n * The `VideoConference` ready-made component is your drop-in solution for a classic video conferencing application.\r\n * It provides functionality such as focusing on one participant, grid view with pagination to handle large numbers\r\n * of participants, basic non-persistent chat, screen sharing, and more.\r\n *\r\n * @remarks\r\n * The component is implemented with other LiveKit components like `FocusContextProvider`,\r\n * `GridLayout`, `ControlBar`, `FocusLayoutContainer` and `FocusLayout`.\r\n * You can use these components as a starting point for your own custom video conferencing application.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <VideoConference />\r\n * <LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function VideoConference({\r\n  chatMessageFormatter,\r\n  chatMessageDecoder,\r\n  chatMessageEncoder,\r\n  SettingsComponent,\r\n  ...props\r\n}: VideoConferenceProps) {\r\n  const [widgetState, setWidgetState] = React.useState<WidgetState>({\r\n    showChat: false,\r\n    unreadMessages: 0,\r\n    showSettings: false,\r\n  });\r\n  const lastAutoFocusedScreenShareTrack = React.useRef<TrackReferenceOrPlaceholder | null>(null);\r\n\r\n  const tracks = useTracks(\r\n    [\r\n      { source: Track.Source.Camera, withPlaceholder: true },\r\n      { source: Track.Source.ScreenShare, withPlaceholder: false },\r\n    ],\r\n    { updateOnlyOn: [RoomEvent.ActiveSpeakersChanged], onlySubscribed: false },\r\n  );\r\n\r\n  const widgetUpdate = (state: WidgetState) => {\r\n    log.debug('updating widget state', state);\r\n    setWidgetState(state);\r\n  };\r\n\r\n  const layoutContext = useCreateLayoutContext();\r\n\r\n  const screenShareTracks = tracks\r\n    .filter(isTrackReference)\r\n    .filter((track) => track.publication.source === Track.Source.ScreenShare);\r\n\r\n  const focusTrack = usePinnedTracks(layoutContext)?.[0];\r\n  const carouselTracks = tracks.filter((track) => !isEqualTrackRef(track, focusTrack));\r\n\r\n  React.useEffect(() => {\r\n    // If screen share tracks are published, and no pin is set explicitly, auto set the screen share.\r\n    if (\r\n      screenShareTracks.some((track) => track.publication.isSubscribed) &&\r\n      lastAutoFocusedScreenShareTrack.current === null\r\n    ) {\r\n      log.debug('Auto set screen share focus:', { newScreenShareTrack: screenShareTracks[0] });\r\n      layoutContext.pin.dispatch?.({ msg: 'set_pin', trackReference: screenShareTracks[0] });\r\n      lastAutoFocusedScreenShareTrack.current = screenShareTracks[0];\r\n    } else if (\r\n      lastAutoFocusedScreenShareTrack.current &&\r\n      !screenShareTracks.some(\r\n        (track) =>\r\n          track.publication.trackSid ===\r\n          lastAutoFocusedScreenShareTrack.current?.publication?.trackSid,\r\n      )\r\n    ) {\r\n      log.debug('Auto clearing screen share focus.');\r\n      layoutContext.pin.dispatch?.({ msg: 'clear_pin' });\r\n      lastAutoFocusedScreenShareTrack.current = null;\r\n    }\r\n    if (focusTrack && !isTrackReference(focusTrack)) {\r\n      const updatedFocusTrack = tracks.find(\r\n        (tr) =>\r\n          tr.participant.identity === focusTrack.participant.identity &&\r\n          tr.source === focusTrack.source,\r\n      );\r\n      if (updatedFocusTrack !== focusTrack && isTrackReference(updatedFocusTrack)) {\r\n        layoutContext.pin.dispatch?.({ msg: 'set_pin', trackReference: updatedFocusTrack });\r\n      }\r\n    }\r\n  }, [\r\n    screenShareTracks\r\n      .map((ref) => `${ref.publication.trackSid}_${ref.publication.isSubscribed}`)\r\n      .join(),\r\n    focusTrack?.publication?.trackSid,\r\n    tracks,\r\n  ]);\r\n\r\n  useWarnAboutMissingStyles();\r\n\r\n  return (\r\n    <div className=\"lk-video-conference\" {...props}>\r\n      {isWeb() && (\r\n        <LayoutContextProvider\r\n          value={layoutContext}\r\n          // onPinChange={handleFocusStateChange}\r\n          onWidgetChange={widgetUpdate}\r\n        >\r\n          <div className=\"lk-video-conference-inner\">\r\n            {!focusTrack ? (\r\n              <div className=\"lk-grid-layout-wrapper\">\r\n                <GridLayout tracks={tracks}>\r\n                  <ParticipantTile />\r\n                </GridLayout>\r\n              </div>\r\n            ) : (\r\n              <div className=\"lk-focus-layout-wrapper\">\r\n                <FocusLayoutContainer>\r\n                  <CarouselLayout tracks={carouselTracks}>\r\n                    <ParticipantTile />\r\n                  </CarouselLayout>\r\n                  {focusTrack && <FocusLayout trackRef={focusTrack} />}\r\n                </FocusLayoutContainer>\r\n              </div>\r\n            )}\r\n            <ControlBar controls={{ chat: true, settings: !!SettingsComponent }} />\r\n          </div>\r\n          <Chat\r\n            style={{ display: widgetState.showChat ? 'grid' : 'none' }}\r\n            messageFormatter={chatMessageFormatter}\r\n            messageEncoder={chatMessageEncoder}\r\n            messageDecoder={chatMessageDecoder}\r\n          />\r\n          {SettingsComponent && (\r\n            <div\r\n              className=\"lk-settings-menu-modal\"\r\n              style={{ display: widgetState.showSettings ? 'block' : 'none' }}\r\n            >\r\n              <SettingsComponent />\r\n            </div>\r\n          )}\r\n        </LayoutContextProvider>\r\n      )}\r\n      <RoomAudioRenderer />\r\n      <ConnectionStateToast />\r\n    </div>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport { ControlBar } from './ControlBar';\r\n\r\nimport { ParticipantAudioTile } from '../components/participant/ParticipantAudioTile';\r\nimport { LayoutContextProvider } from '../components/layout/LayoutContextProvider';\r\nimport type { WidgetState } from '@livekit/components-core';\r\nimport { Chat } from './Chat';\r\nimport { TrackLoop } from '../components';\r\nimport { useTracks } from '../hooks';\r\nimport { useWarnAboutMissingStyles } from '../hooks/useWarnAboutMissingStyles';\r\nimport { Track } from 'livekit-client';\r\n\r\n/** @public */\r\nexport interface AudioConferenceProps extends React.HTMLAttributes<HTMLDivElement> {}\r\n\r\n/**\r\n * This component is the default setup of a classic LiveKit audio conferencing app.\r\n * It provides functionality like switching between participant grid view and focus view.\r\n *\r\n * @remarks\r\n * The component is implemented with other LiveKit components like `FocusContextProvider`,\r\n * `GridLayout`, `ControlBar`, `FocusLayoutContainer` and `FocusLayout`.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <AudioConference />\r\n * <LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function AudioConference({ ...props }: AudioConferenceProps) {\r\n  const [widgetState, setWidgetState] = React.useState<WidgetState>({\r\n    showChat: false,\r\n    unreadMessages: 0,\r\n  });\r\n\r\n  const audioTracks = useTracks([Track.Source.Microphone]);\r\n\r\n  useWarnAboutMissingStyles();\r\n\r\n  return (\r\n    <LayoutContextProvider onWidgetChange={setWidgetState}>\r\n      <div className=\"lk-audio-conference\" {...props}>\r\n        <div className=\"lk-audio-conference-stage\">\r\n          <TrackLoop tracks={audioTracks}>\r\n            <ParticipantAudioTile />\r\n          </TrackLoop>\r\n        </div>\r\n        <ControlBar\r\n          controls={{ microphone: true, screenShare: false, camera: false, chat: true }}\r\n        />\r\n        {widgetState.showChat && <Chat />}\r\n      </div>\r\n    </LayoutContextProvider>\r\n  );\r\n}\r\n","import { Track } from 'livekit-client';\r\nimport * as React from 'react';\r\nimport { MediaDeviceMenu } from './MediaDeviceMenu';\r\nimport { TrackToggle } from '../components/controls/TrackToggle';\r\nimport {\r\n  useLocalParticipant,\r\n  useLocalParticipantPermissions,\r\n  usePersistentUserChoices,\r\n} from '../hooks';\r\nimport { mergeProps } from '../utils';\r\nimport { StartMediaButton } from '../components/controls/StartMediaButton';\r\nimport { BarVisualizer, DisconnectButton } from '../components';\r\nimport type { TrackReferenceOrPlaceholder } from '@livekit/components-core';\r\n\r\n/** @beta */\r\nexport type VoiceAssistantControlBarControls = {\r\n  microphone?: boolean;\r\n  leave?: boolean;\r\n};\r\n\r\n/** @beta */\r\nexport interface VoiceAssistantControlBarProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  onDeviceError?: (error: { source: Track.Source; error: Error }) => void;\r\n  controls?: VoiceAssistantControlBarControls;\r\n  /**\r\n   * If `true`, the user's device choices will be persisted.\r\n   * This will enables the user to have the same device choices when they rejoin the room.\r\n   * @defaultValue true\r\n   */\r\n  saveUserChoices?: boolean;\r\n}\r\n\r\n/**\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom ... >\r\n *   <VoiceAssistantControlBar />\r\n * </LiveKitRoom>\r\n * ```\r\n * @beta\r\n */\r\nexport function VoiceAssistantControlBar({\r\n  controls,\r\n  saveUserChoices = true,\r\n  onDeviceError,\r\n  ...props\r\n}: VoiceAssistantControlBarProps) {\r\n  const visibleControls = { leave: true, microphone: true, ...controls };\r\n\r\n  const localPermissions = useLocalParticipantPermissions();\r\n  const { microphoneTrack, localParticipant } = useLocalParticipant();\r\n\r\n  const micTrackRef: TrackReferenceOrPlaceholder = React.useMemo(() => {\r\n    return {\r\n      participant: localParticipant,\r\n      source: Track.Source.Microphone,\r\n      publication: microphoneTrack,\r\n    };\r\n  }, [localParticipant, microphoneTrack]);\r\n\r\n  if (!localPermissions) {\r\n    visibleControls.microphone = false;\r\n  } else {\r\n    visibleControls.microphone ??= localPermissions.canPublish;\r\n  }\r\n\r\n  const htmlProps = mergeProps({ className: 'lk-agent-control-bar' }, props);\r\n\r\n  const { saveAudioInputEnabled, saveAudioInputDeviceId } = usePersistentUserChoices({\r\n    preventSave: !saveUserChoices,\r\n  });\r\n\r\n  const microphoneOnChange = React.useCallback(\r\n    (enabled: boolean, isUserInitiated: boolean) => {\r\n      if (isUserInitiated) {\r\n        saveAudioInputEnabled(enabled);\r\n      }\r\n    },\r\n    [saveAudioInputEnabled],\r\n  );\r\n\r\n  return (\r\n    <div {...htmlProps}>\r\n      {visibleControls.microphone && (\r\n        <div className=\"lk-button-group\">\r\n          <TrackToggle\r\n            source={Track.Source.Microphone}\r\n            showIcon={true}\r\n            onChange={microphoneOnChange}\r\n            onDeviceError={(error) => onDeviceError?.({ source: Track.Source.Microphone, error })}\r\n          >\r\n            <BarVisualizer trackRef={micTrackRef} barCount={7} options={{ minHeight: 5 }} />\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              kind=\"audioinput\"\r\n              onActiveDeviceChange={(_kind, deviceId) =>\r\n                saveAudioInputDeviceId(deviceId ?? 'default')\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {visibleControls.leave && <DisconnectButton>{'Отключиться'}</DisconnectButton>}\r\n      <StartMediaButton />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["Chat","messageFormatter","messageDecoder","messageEncoder","channelTopic","props","ulRef","React","inputRef","chatOptions","chatMessages","send","isSending","useChat","layoutContext","useMaybeLayoutContext","lastReadMsgAt","handleSubmit","event","_a","_b","_c","unreadMessageCount","msg","widget","_d","_e","ChatToggle","ChatCloseIcon","idx","cloneSingleChild","allMsg","hideName","hideTimestamp","ChatEntry","ev","MediaDeviceMenu","kind","initialSelection","onActiveDeviceChange","tracks","requestPermissions","isOpen","setIsOpen","devices","setDevices","updateRequired","setUpdateRequired","needPermissions","setNeedPermissions","handleActiveDeviceChange","deviceId","log","button","tooltip","cleanup","computeMenuPosition","x","y","handleClickOutside","wasClickOutside","MediaDeviceSelect","useWarnAboutMissingStyles","warnAboutMissingStyles","usePreviewTracks","options","onError","setTracks","trackLock","Mutex","needsCleanup","localTracks","unlock","createLocalTracks","tr","e","track","roomOptionsStringifyReplacer","usePreviewDevice","enabled","deviceError","setDeviceError","isCreatingTrack","setIsCreatingTrack","useMediaDevices","selectedDevice","setSelectedDevice","localTrack","setLocalTrack","localDeviceId","setLocalDeviceId","createTrack","createLocalVideoTrack","VideoPresets","createLocalAudioTrack","newDeviceId","prevDeviceId","switchDevice","id","dev","PreJoin","defaults","onValidate","onSubmit","debug","joinLabel","micLabel","camLabel","userLabel","persistUserChoices","videoProcessor","htmlProps","initialUserChoices","saveAudioInputDeviceId","saveAudioInputEnabled","saveVideoInputDeviceId","saveVideoInputEnabled","saveUsername","usePersistentUserChoices","userChoices","setUserChoices","audioEnabled","setAudioEnabled","videoEnabled","setVideoEnabled","audioDeviceId","setAudioDeviceId","videoDeviceId","setVideoDeviceId","username","setUsername","videoEl","videoTrack","Track","facingMode","facingModeFromLocalTrack","audioTrack","isValid","setIsValid","handleValidation","values","newUserChoices","ParticipantPlaceholder","TrackToggle","_","inputEl","useSettingsToggle","dispatch","state","useLayoutContext","className","mergeProps","SettingsMenuToggle","ref","mergedProps","trackSourceToProtocol","source","ControlBar","variation","controls","saveUserChoices","onDeviceError","isChatOpen","setIsChatOpen","defaultVariation","useMediaQuery","visibleControls","localPermissions","useLocalParticipantPermissions","canPublishSource","showIcon","showText","browserSupportsScreenSharing","supportsScreenSharing","isScreenShareEnabled","setIsScreenShareEnabled","onScreenShareChange","microphoneOnChange","isUserInitiated","cameraOnChange","error","_kind","ChatIcon","GearIcon","DisconnectButton","LeaveIcon","StartMediaButton","VideoConference","chatMessageFormatter","chatMessageDecoder","chatMessageEncoder","SettingsComponent","widgetState","setWidgetState","lastAutoFocusedScreenShareTrack","useTracks","RoomEvent","widgetUpdate","useCreateLayoutContext","screenShareTracks","isTrackReference","focusTrack","usePinnedTracks","carouselTracks","isEqualTrackRef","updatedFocusTrack","_f","isWeb","LayoutContextProvider","FocusLayoutContainer","CarouselLayout","ParticipantTile","FocusLayout","GridLayout","RoomAudioRenderer","ConnectionStateToast","AudioConference","audioTracks","TrackLoop","ParticipantAudioTile","VoiceAssistantControlBar","microphoneTrack","localParticipant","useLocalParticipant","micTrackRef","BarVisualizer"],"mappings":"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"}